name: Example Docker Action

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Setup Docker
      uses: docker://docker:19.03.13

    # - name: Run command
    #   run: docker run --rm -v "$PWD":/app -w /app we2app/cordova:latest sh -c "echo 'Hello, GitHub Actions in Docker!'"

    # - name: create container from image named we2app/cordova
    #   run: docker create --name cordova we2app/cordova:latest

    - name: create container from image named we2app/cordova
      run: docker run -i -v $(pwd):/app --name cordova we2app/cordova sh -c "cd /app && export ANDROID_HOME=/opt/android-sdk && export ANDROID_SDK_ROOT=/opt/android-sdk && export PATH=$PATH:$ANDROID_HOME/cmdline-tools/latest/bin/:$ANDROID_HOME/platform-tools && ls && cordova platform add android && cordova build android"

    # - name: Upload build to release
    #   uses: softprops/action-gh-release@v1
    #   with:
    #     files: platforms/android/app/build/outputs/apk/debug/app-debug.apk

    - name: Create Release
        id: create_release
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
            tag_name: ${{ github.event.head_commit.message }}
            release_name: Release ${{ github.event.head_commit.message }}
            draft: false
            prerelease: false
            
    - name: Upload Release Asset
      id: upload-release-asset 
      uses: actions/upload-release-asset@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
          upload_url: ${{ steps.create_release.outputs.upload_url }} # This pulls from the CREATE RELEASE step above, referencing it's ID to get its outputs object, which include a `upload_url`. See this blog post for more info: https://jasonet.co/posts/new-features-of-github-actions/#passing-data-to-future-steps 
          asset_path: platforms/android/app/build/outputs/apk/debug/app-debug.apk
          asset_name: Debug ${{ github.event.head_commit.message }}.apk
          asset_content_type: application/zip